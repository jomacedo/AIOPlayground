apiVersion: mq.iotoperations.azure.com/v1beta1
kind: KafkaConnectorTopicMap
metadata:
  name: plcsimulatortm
  namespace: azure-iot-operations
spec:
  kafkaConnectorRef: my-eh-connector
#  compression: snappy
  batching:
    enabled: true
    latencyMs: 1000
    maxMessages: 100
    maxBytes: 1024
  partitionStrategy: property
  partitionKeyProperty: device-id
  copyMqttProperties: true
  routes:
    # Subscribe from MQTT topic "thermostat" and send to Kafka topic "receiving-event-hub"
    - mqttToKafka:
        name: "plcsimulator-route1"
        mqttTopic: azure-iot-operations/data/opc-ua-connector-0/thermostat
        kafkaTopic: receiving-plcsimulator
        kafkaAcks: one
        qos: 1
        sharedSubscription:
          groupName: group1
          groupMinimumShareNumber: 3
    # Pull from kafka topic "sending-event-hub" and publish to MQTT topic "thermostat-commands"
    - kafkaToMqtt:
        name: "plcsimulator-route2"
        consumerGroupId: mqConnector
        kafkaTopic: sending-plcsimulator
        mqttTopic: azure-iot-operations/data/opc-ua-connector-0/thermostat-commands
        qos: 0